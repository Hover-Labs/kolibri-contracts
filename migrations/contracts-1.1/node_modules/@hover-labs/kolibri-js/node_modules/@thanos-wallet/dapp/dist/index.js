var e,r,t,n=require("nanoid"),o=require("@taquito/taquito");function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function a(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r}function i(e,r){if(null==e)return{};var t,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r.indexOf(t=s[n])>=0||(o[t]=e[t]);return o}(e=exports.ThanosDAppMessageType||(exports.ThanosDAppMessageType={})).GetCurrentPermissionRequest="GET_CURRENT_PERMISSION_REQUEST",e.GetCurrentPermissionResponse="GET_CURRENT_PERMISSION_RESPONSE",e.PermissionRequest="PERMISSION_REQUEST",e.PermissionResponse="PERMISSION_RESPONSE",e.OperationRequest="OPERATION_REQUEST",e.OperationResponse="OPERATION_RESPONSE",e.SignRequest="SIGN_REQUEST",e.SignResponse="SIGN_RESPONSE",e.BroadcastRequest="BROADCAST_REQUEST",e.BroadcastResponse="BROADCAST_RESPONSE",(r=exports.ThanosDAppErrorType||(exports.ThanosDAppErrorType={})).NotGranted="NOT_GRANTED",r.NotFound="NOT_FOUND",r.InvalidParams="INVALID_PARAMS",r.TezosOperation="TEZOS_OPERATION",(t=exports.ThanosPageMessageType||(exports.ThanosPageMessageType={})).Request="THANOS_PAGE_REQUEST",t.Response="THANOS_PAGE_RESPONSE",t.ErrorResponse="THANOS_PAGE_ERROR_RESPONSE";var p=function(e){try{return Promise.resolve(y({type:exports.ThanosDAppMessageType.BroadcastRequest,signedOpBytes:e})).then(function(e){return f(e.type===exports.ThanosDAppMessageType.BroadcastResponse),e.opHash})}catch(e){return Promise.reject(e)}},u=function(e,r){try{return Promise.resolve(y({type:exports.ThanosDAppMessageType.SignRequest,sourcePkh:e,payload:r})).then(function(e){return f(e.type===exports.ThanosDAppMessageType.SignResponse),e.signature})}catch(e){return Promise.reject(e)}},c=function(e,r){try{return Promise.resolve(y({type:exports.ThanosDAppMessageType.OperationRequest,sourcePkh:e,opParams:r})).then(function(e){return f(e.type===exports.ThanosDAppMessageType.OperationResponse),e.opHash})}catch(e){return Promise.reject(e)}},l=function(e,r,t){try{return Promise.resolve(y({type:exports.ThanosDAppMessageType.PermissionRequest,network:e,appMeta:r,force:t})).then(function(e){return f(e.type===exports.ThanosDAppMessageType.PermissionResponse),{rpc:e.rpc,pkh:e.pkh,publicKey:e.publicKey}})}catch(e){return Promise.reject(e)}},h=function(){try{return Promise.resolve(y({type:exports.ThanosDAppMessageType.GetCurrentPermissionRequest})).then(function(e){return f(e.type===exports.ThanosDAppMessageType.GetCurrentPermissionResponse),e.permission})}catch(e){return Promise.reject(e)}};function m(){return new Promise(function(e){var r=function(e){var r,n;e.source===window&&(null===(r=e.data)||void 0===r?void 0:r.type)===exports.ThanosPageMessageType.Response&&"PONG"===(null===(n=e.data)||void 0===n?void 0:n.payload)&&t(!0)},t=function(t){e(t),window.removeEventListener("message",r),clearTimeout(n)};v({type:exports.ThanosPageMessageType.Request,payload:"PING"}),window.addEventListener("message",r);var n=setTimeout(function(){return t(!1)},500)})}function T(e){var r,t=!1;return function n(o){void 0===o&&(o=0);try{var s=o<5;return Promise.resolve(m()).then(function(a){t!==a&&(e(a),t=a),r=setTimeout(n,a?1e4:s?0:5e3,s?o+1:o)})}catch(e){return Promise.reject(e)}}(),function(){return clearTimeout(r)}}function P(e){var r,t=null;return function n(){try{var o=function(){r=setTimeout(n,1e4)},s=function(r,n){try{var o=Promise.resolve(h()).then(function(r){var n,o;o=t,(null===(n=r)?null===o:n.pkh===(null==o?void 0:o.pkh)&&n.rpc===(null==o?void 0:o.rpc))||(e(r),t=r)})}catch(e){return}return o&&o.then?o.then(void 0,function(){}):o}();return Promise.resolve(s&&s.then?s.then(o):o())}catch(e){return Promise.reject(e)}}(),function(){return clearTimeout(r)}}function y(e){return new Promise(function(r,t){var s=n.nanoid();v({type:exports.ThanosPageMessageType.Request,payload:e,reqId:s}),window.addEventListener("message",function e(n){var a=n.data;switch(!0){case n.source!==window||(null==a?void 0:a.reqId)!==s:return;case(null==a?void 0:a.type)===exports.ThanosPageMessageType.Response:r(a.payload),window.removeEventListener("message",e);break;case(null==a?void 0:a.type)===exports.ThanosPageMessageType.ErrorResponse:t(function(e){switch(!0){case e===exports.ThanosDAppErrorType.NotGranted:return new g;case e===exports.ThanosDAppErrorType.NotFound:return new E;case e===exports.ThanosDAppErrorType.InvalidParams:return new R;case Array.isArray(e)&&e[0]===exports.ThanosDAppErrorType.TezosOperation&&Array.isArray(e[1])&&e[1].length>0:return new o.TezosOperationError(e[1]);case"string"==typeof e&&e.startsWith("__tezos__"):return new Error(e.replace("__tezos__",""));default:return new d}}(a.payload)),window.removeEventListener("message",e)}})})}function f(e){if(!e)throw new Error("Invalid response recieved")}function v(e){window.postMessage(e,"*")}var d=function(){this.name="ThanosWalletError",this.message="An unknown error occured. Please try again or report it"},g=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotGrantedThanosWalletError",r.message="Permission Not Granted",r}return a(r,e),r}(d),E=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="NotFoundThanosWalletError",r.message="Account Not Found. Try connect again",r}return a(r,e),r}(d),R=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="InvalidParamsThanosWalletError",r.message="Some of the parameters you provided are invalid",r}return a(r,e),r}(d),O=function(){function e(e,r){this.appName=e,this.permission=null,r&&(this.permission=r)}var r,t=e.prototype;return t.toTezos=function(){S(this.permission);var e=new o.TezosToolkit(this.permission.rpc);return e.setProvider({wallet:this}),e},t.connect=function(e,r){void 0===r&&(r={forcePermission:!1});try{var t=this;return Promise.resolve(l(e,{name:t.appName},r.forcePermission)).then(function(e){t.permission=e})}catch(e){return Promise.reject(e)}},t.reconnect=function(e){return this.connect(e,{forcePermission:!0})},t.getPKH=function(){try{return S(this.permission),Promise.resolve(this.permission.pkh)}catch(e){return Promise.reject(e)}},t.mapTransferParamsToWalletParams=function(e){try{return Promise.resolve(o.createTransferOperation(e))}catch(e){return Promise.reject(e)}},t.mapOriginateParamsToWalletParams=function(e){try{return Promise.resolve(o.createOriginationOperation(e))}catch(e){return Promise.reject(e)}},t.mapDelegateParamsToWalletParams=function(e){try{return Promise.resolve(o.createSetDelegateOperation(e))}catch(e){return Promise.reject(e)}},t.sendOperations=function(e){try{return S(this.permission),Promise.resolve(c(this.permission.pkh,e.map(N)))}catch(e){return Promise.reject(e)}},t.sign=function(e){try{return S(this.permission),Promise.resolve(u(this.permission.pkh,e))}catch(e){return Promise.reject(e)}},t.broadcast=function(e){try{return S(this.permission),Promise.resolve(p(e))}catch(e){return Promise.reject(e)}},(r=[{key:"connected",get:function(){return Boolean(this.permission)}}])&&function(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,r),e}();O.isAvailable=m,O.onAvailabilityChange=T,O.getCurrentPermission=h,O.onPermissionChange=P;var A=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).name="ThanosWalletNotConnected",r.message="You need to connect ThanosWallet by calling thanosWallet.connect() first",r}return a(r,e),r}(d);function S(e){if(!e)throw new A}function N(e){var r=i(e,["fee","gas_limit","storage_limit"]);switch(e.kind){case"origination":return s({},r,{mutez:!0});case"transaction":var t=r.destination,n=r.amount,o=r.parameters;return s({},i(r,["destination","amount","parameters"]),{to:t,amount:+n,mutez:!0,parameter:o});default:return r}}exports.InvalidParamsThanosWalletError=R,exports.NotConnectedThanosWalletError=A,exports.NotFoundThanosWalletError=E,exports.NotGrantedThanosWalletError=g,exports.ThanosWallet=O,exports.ThanosWalletError=d,exports.getCurrentPermission=h,exports.isAvailable=m,exports.onAvailabilityChange=T,exports.onPermissionChange=P,exports.requestBroadcast=p,exports.requestOperation=c,exports.requestPermission=l,exports.requestSign=u;
//# sourceMappingURL=index.js.map
